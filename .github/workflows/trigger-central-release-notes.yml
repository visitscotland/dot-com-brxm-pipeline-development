name: "Trigger Central Release Notes Workflow"

on:
  workflow_dispatch:  # Allows manual triggering from GitHub UI
  push:
    tags:
      - '*'  # Runs on every tag push

jobs:
  trigger_central_workflow:
    name: "Trigger Centralized Release Notes Workflow"
    runs-on: ubuntu-latest
    permissions:
      actions: write  # Allows triggering other workflows
      contents: read   # Ensures access to repo contents

    steps:
      - name: Debug GITHUB_TOKEN Permissions
        id: gh_token_permissions
        run: |
          curl -H "Authorization: token $GITHUB_TOKEN" \
               -H "Accept: application/vnd.github.v3+json" \
               https://api.github.com/user

      - name: "Checkout Repository (Full History and Tags)"
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # fetches the full history, including all commits
          fetch-tags: true # fetches all tags

      - name: "Get Repository Info & Debug"
        id: repo_info
        REPO_NAME: ${{ github.event.repository.name }}
        REPO_OWNER: ${{ github.event.repository.owner.login }}
        GIT_REF: ${{ github.ref }}
        run: |
          echo "🔍 Debugging Repository Variables..."
          echo "🔹 Repository Name: $REPO_NAME"
          echo "🔹 Repository Owner: $REPO_OWNER"
          echo "🔹 GitHub Reference (Full): $GIT_REF"
          
          # Extract and store values in GitHub Actions environment
          echo "REPO_NAME=$REPO_NAME" >> $GITHUB_ENV
          echo "REPO_OWNER=$REPO_OWNER" >> $GITHUB_ENV
          echo "LATEST_TAG=${GIT_REF#refs/tags/}" >> $GITHUB_ENV
          
          # Print final stored variables
          echo "✅ Stored Environment Variables:"
          echo "REPO_NAME=$REPO_NAME"
          echo "REPO_OWNER=$REPO_OWNER"
          echo "LATEST_TAG=$LATEST_TAG"

#      - name: "Invoke Central Workflow"
#        uses: actions/github-script@v7 # GH marketplace action that uses the GitHub API without needing curl (March 2025: v7)
#        with:
#          github-token: ${{ secrets.ORG_GITHUB_TOKEN }}
#          script: |
#            await github.rest.actions.createWorkflowDispatch({
#              owner: "github-org",
#              repo: "release-notes-workflow",
#              workflow_id: "central-release-notes.yml",
#              ref: "main",
#              inputs: {
#                REPO_NAME: process.env.REPO_NAME,
#                REPO_OWNER: process.env.REPO_OWNER,
#                LATEST_TAG: process.env.LATEST_TAG
#              }
#            });
